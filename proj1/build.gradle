/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

plugins {
    id 'org.hidetake.ssh' version '2.9.0'
}

apply plugin: 'java'

remotes {
    glados {
        host = "glados.cs.rit.edu"
        user = "wpl3499"
        identity = file("/home/wheeler/.ssh/rit")
    }
}

task csTest {
    doLast {
        ssh.run {
            session(remotes.glados) {
                execute 'rm -rf csci331proj1; mkdir csci331proj1'
                put from: "$project.projectDir.path/src/main/java/Search.java", into: 'csci331proj1'
                put from: "$project.projectDir.path/in1", into: 'csci331proj1'
                put from: "$project.projectDir.path/in2", into: 'csci331proj1'
                put from: "$project.projectDir.path/out1", into: 'csci331proj1'
                put from: "$project.projectDir.path/out2", into: 'csci331proj1'
                put from: "$project.projectDir.path/city.dat", into: 'csci331proj1'
                put from: "$project.projectDir.path/edge.dat", into: 'csci331proj1'
                executeScript '''#!/usr/bin/env bash
set -e
cd csci331proj1
/usr/local/dcs/jdk/bin/javac Search.java

/usr/local/dcs/jdk/bin/java Search in1 output1
diff -w output1 out1

/usr/local/dcs/jdk/bin/java Search in2 output2
diff -w output2 out2

/usr/local/dcs/jdk/bin/java Search - output3 < in1
diff -w output3 out1

/usr/local/dcs/jdk/bin/java Search in1 - > output4
diff -w output4 out1

/usr/local/dcs/jdk/bin/java Search - - < in1 > output5
diff -w output5 out1
'''

            }
        }
    }
}

task createSubmission(type: Zip){
    from "src/main/java/"
    include "*.java"
    archiveName 'csci331_proj1_wpl3499.zip'
    destinationDir(buildDir)
}